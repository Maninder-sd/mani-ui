<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>




    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
        integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

</head>
<style>
    body {
        background-color: darkslategrey !important;
    }

    .toolbar {
        display: flex;
        flex-direction: row;
        align-items: center;
        background-color: #7AC143;
        border-radius: 20px;
        border-top-left-radius: 0;
        border-top-right-radius: 0;
        transition: box-shadow 0.3s;
        padding: 10px;
        column-gap: 20px;
        margin: 0 20px 0 20px;
        padding-left: 40px;
        margin-bottom: 10px;
    }

    .toolbar:hover {
        box-shadow: 0 0 10px black;
    }

    #canvas-placeholder {
        width: 100%;
        height: 100%;
    }

    #canvas-name-container {
        background: ;
        border-radius: 12px 12px 0 0;
        border: 2px solid #e94560;
        border-bottom: none;
        margin-top: 10px;
        padding: 5px 0;
        display: flex;
        flex-direction: row;
        justify-content: space-around;
        position: relative;
        margin-left: 20px;
        width: calc(100vw - 40px);
    }


    #canvas-name {
        width: fit-content;
        margin: 0;
        color: #ffffff;
        font-size: 26px;
        font-weight: 500;
        letter-spacing: 2px;
        font-family: 'Trebuchet MS', 'Lucida Sans', Arial, sans-serif;
        text-transform: uppercase;
        position: relative;
        z-index: 1;
    }

    #explaination {
        display: flex;
        flex-direction: row;
        align-items: center;
        cursor: pointer;
    }

    #explaination i {
        transition: box-shadow 0.3s;
        border-radius: 10px;
    }

    #explaination i:hover {
        box-shadow: 0 0 10px black;
    }

    #canvas-selection {
        text-align: center;
        height: fit-content;
        color: darkgreen;
        font-size: large;
        font-weight: 600;
        background-color: #f6eee3;
        padding: 3px 30px;
        border-radius: 10px;
        /* margin: 0 30px; */
    }
</style>


<body style="padding:0;margin:0;height:100vh; display: flex; flex-direction:column;">


    <div class="toolbar">

        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"
                aria-expanded="false">
                Select a canvas
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="?id=1">Canvas 1</a></li>
                <li><a class="dropdown-item" href="?id=2">Canvas 2</a></li>
                <li><a class="dropdown-item" href="?id=3">Canvas 3</a></li>
            </ul>
        </div>

        <button id="clear-local-data" type="button" class="btn btn-danger">Clear local data</button>


        <div class="vert-divider" style="width:3px;height:30px; background-color:black;"></div>

        <div id="canvas-selection"> No Canvas selected</div>

        <div id="explaination" style="display:none;">
            <i class="fa-solid fa-circle-info" style="font-size: large; height: fit-content"></i>
        </div>
    </div>

    <!-- failure screen -->
    <div id="failed-to-find" style="
        padding: 16px 24px;
        background-color: #ffe5e5;
        border: 1px solid #ffb3b3;
        color: #a30000;
        border-radius: 8px;
        font-size: 16px;
        font-family: Arial, sans-serif;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        display:none;
    ">
        Failed to find the layout
    </div>


    <div style="width: 100vw; flex:1; padding: 0 20px 0 20px; ">
        <div class="" id="canvas-placeholder"></div>
    </div>



</body>

<script type="module">

    // =============================== setting up local storage ================================== //

    const urlParams = new URLSearchParams(window.location.search);
    const selectedId = urlParams.get('id');
    if (selectedId) {
        $("#canvas-selection").text("Canvas " + selectedId + " selected")
    }

    $("#clear-local-data").click(() => {
        localStorage.clear();
        location.reload();
    })

    if (!localStorage.getItem("example")) {
        localStorage.setItem("example", JSON.stringify({
            "canvas 1": [],
            "canvas 2": [],
            "canvas 3": [],

        }));
    }



    import CustomCanvas from 'mani-ui/canvas/CustomCanvas.js'

    async function setupCanvas() {

        const templateId = 123;
        const layoutId = 123;
        const layoutname = "123";
        if (!selectedId) {
            console.log("nothing selected")
            return;
        }


        const canvas = new CustomCanvas("canvas-placeholder", templateId, layoutId, layoutname);

        // $("#canvas-name").text(layoutname);

        let localData = JSON.parse(localStorage.getItem("example"))
        console.log(localData);

        let templateCards = localData["canvas " + selectedId]
        await canvas.loadData(templateCards) // if using a template

        const params = new URLSearchParams(window.location.search);
        const isFullscreen = params.get("isVideoWall") === "true";
        canvas.editPermissions(true, true);

        canvas.createTemplateCard = async (card) => {

            let localData = JSON.parse(localStorage.getItem("example"))
            console.log(localData);
            let templateCards = localData["canvas " + selectedId]
            templateCards.push(card.templateCard)

            localStorage.setItem("example", JSON.stringify(localData))
            return { cardId: card.cardId, id: card.cardId };
        };
        // =========
        canvas.deleteTemplateCard = async (card) => {

            let localData = JSON.parse(localStorage.getItem("example"))
            console.log(localData);
            let templateCards = localData["canvas " + selectedId]
            let toDelete = templateCards.find((x) => { return x.cardId == card.cardId });
            let index = templateCards.indexOf(toDelete);
            templateCards.splice(index, 1)

            localStorage.setItem("example", JSON.stringify(localData))
            return { cardId: card.cardId, id: card.cardId };
        };
        // =========

        // =========
        canvas.updateTemplateCard = async (card) => {

            let localData = JSON.parse(localStorage.getItem("example"))
            console.log(localData);
            let templateCards = localData["canvas " + selectedId]
            let toDelete = templateCards.find((x) => { return x.cardId == card.cardId });
            let index = templateCards.indexOf(toDelete);
            templateCards.splice(index, 1)
            templateCards.push(card.templateCard)

            localStorage.setItem("example", JSON.stringify(localData))
            return { cardId: card.cardId, id: card.cardId };
        };
        // =========


    }

    // =================================== ============================== //


    $(document).ready(async function () {
        await setupCanvas();
    });


</script>

</html>